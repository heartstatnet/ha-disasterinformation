type: markdown
title: 🌍 地震情報 (直近24時間)
content: >
  {% set earthquake_entity = 'sensor.earthquake_information' %}
  {% set detection_entity = 'binary_sensor.earthquake_detection' %}

  **現在の状況**: {{ states(earthquake_entity) }}

  **地震検知状態**: {{ '🔴 ON' if is_state(detection_entity, 'on') else '🟢 OFF' }}

  **検索条件**:
  - 時間範囲: {{ state_attr(earthquake_entity, 'time_range_hours') }}時間
  - 最小マグニチュード: M{{ state_attr(earthquake_entity, 'min_magnitude') }}
  - ステータス: {{ state_attr(earthquake_entity, 'status') }}

  ---

  {% set latest_earthquake = state_attr(earthquake_entity, 'latest_earthquake') %}
  {% if latest_earthquake %}
  **最新地震**:
  - 発生時刻: {{ latest_earthquake.origin_time }}
  - 震源地: {{ latest_earthquake.hypocenter }}
  - マグニチュード: M{{ latest_earthquake.magnitude }}
  - 発表時刻: {{ latest_earthquake.report_datetime }}
  
  ---
  {% endif %}

  {% set recent_earthquakes = state_attr(earthquake_entity, 'recent_earthquakes') %}
  {% if recent_earthquakes and recent_earthquakes|length > 0 %}
  **直近の地震一覧**:
  
  | 発表時刻 | 震源地 | マグニチュード |
  |----------|--------|----------------|
  {% for eq in recent_earthquakes %}
  | {{ as_timestamp(strptime(eq.report_datetime, '%Y-%m-%dT%H:%M:%S%z')) | timestamp_custom('%m/%d %H:%M') }} | {{ eq.hypocenter }} | M{{ eq.magnitude }} |
  {% endfor %}
  
  ---
  
  **統計情報**:
  - 該当地震数: {{ state_attr(earthquake_entity, 'earthquake_count') }}件
  - 最大マグニチュード: M{{ recent_earthquakes | map(attribute='magnitude') | map('float') | max }}
  - 最小マグニチュード: M{{ recent_earthquakes | map(attribute='magnitude') | map('float') | min }}
  {% else %}
  **直近の地震**: 該当する地震はありません
  {% endif %}

  ---
  
  **データ更新時刻**: {{ as_timestamp(now()) | timestamp_custom('%Y/%m/%d %H:%M:%S') }}